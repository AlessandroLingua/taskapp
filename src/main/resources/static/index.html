<!doctype html>
<html lang="it" ng-app="TaskApp">
<head>
    <meta charset="utf-8">
    <title>TaskApp</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.20/angular.min.js"></script>
    <script src="js/app.js"></script>
    <style>
        body { font-family: system-ui, sans-serif; padding: 24px; }
        table { border-collapse: collapse; width: 100%; margin-top: 12px; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { text-align: left; }
        .row { margin: 8px 0; }
        button { margin-left: 6px; }
    </style>
</head>
<body ng-controller="TaskCtrl" ng-init="load(); loadPaged()">
<h1>Task Manager</h1>

<div class="row">
    <strong>Nuovo task / Modifica</strong><br/>
    <input placeholder="Titolo" ng-model="form.title" required>
    <input placeholder="Descrizione" ng-model="form.description">
    <select ng-model="form.categoryId" ng-options="c.id as c.name for c in categories">
        <option value="">-- nessuna categoria --</option>
    </select>
    <button ng-click="save()">{{ editMode ? 'Salva' : 'Aggiungi' }}</button>
    <button ng-show="editMode" ng-click="cancelEdit()">Annulla</button>
    <span style="color:green" ng-show="ok">{{ok}}</span>
    <span style="color:red"   ng-show="err">{{err}}</span>
</div>

<div class="row">
    <strong>Nuova categoria</strong><br/>
    <input placeholder="Nome" ng-model="cat.name">
    <input placeholder="Descrizione" ng-model="cat.description">
    <button ng-click="addCategory()">Aggiungi categoria</button>
</div>

<div class="row">
    <label>Filtra per categoria: </label>
    <select ng-model="filterCategoryId" ng-options="c.id as c.name for c in categories"
            ng-change="page=0; loadPaged()">
        <option value="">(tutte)</option>
    </select>
    <input placeholder="Cerca titolo..." ng-model="search">
    <button ng-click="page=0; loadPaged()">Cerca</button>
</div>

<table>
    <tr><th>ID</th><th>Titolo</th><th>Descrizione</th><th>Categoria</th><th></th></tr>
    <tr ng-repeat="t in tasks | filter:byCategory">
        <td>{{t.id}}</td>
        <td>{{t.title}}</td>
        <td>{{t.description}}</td>
        <td>{{t.categoryName || '-'}}</td>
        <td>
            <button ng-click="startEdit(t)">Modifica</button>
            <button ng-click="del(t)">Elimina</button>
        </td>
    </tr>
</table>

<div class="row" ng-if="paged">
    <button ng-disabled="paged.first" ng-click="page=page-1; loadPaged()">Prev</button>
    <span> Pagina {{(paged.page||0)+1}} / {{paged.totalPages||1}} </span>
    <button ng-disabled="paged.last" ng-click="page=page+1; loadPaged()">Next</button>
</div>
</body>
</html>